matrix:
  include:
    - language: node_js
      dist: trusty
      cache: npm
      node_js: "12.13"
      install:
        - npm install --prefix client
      script:
        - npm run build --prefix client

    - language: java
      dist: trusty
      cache:
        bundler: true
        directories:
          - $HOME/.m2
          - $HOME/docker
      services:
        - docker
      before_install:
        - docker network create grid
        - docker run -d -p 4444:4444 --net grid --name selenium-hub selenium/hub:3.141.59-zirconium
        - docker run -d --net grid -e HUB_HOST=selenium-hub -v /dev/shm:/dev/shm selenium/node-chrome:3.141.59-zirconium
        - docker run -d --net grid -e HUB_HOST=selenium-hub -v /dev/shm:/dev/shm selenium/node-firefox:3.141.59-zirconium
      jdk: oraclejdk8

      script:
        - docker-compose -f ./docker/docker-compose.yaml up -d
        - . ./docker/wait-for-grid.sh
        - mvn clean test -Dtest.group=all --file server
        - docker-compose -f ./docker/docker-compose.yaml down