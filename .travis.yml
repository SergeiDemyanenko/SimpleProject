jobs:
  include:
    - language: node_js
      dist: trusty
      cache: npm
      node_js: "12.13"
      install:
        - npm install --prefix client
      script:
        - npm run build --prefix client

    - language: java
      dist: trusty
      cache:
        bundler: true
        directories:
          - $HOME/.m2
          - $HOME/docker
      addons:
        apt:
          packages:
            - net-tools
      services:
        - docker
      jdk: oraclejdk8

      script:
        - ifconfig
        - export HOST_IP=$(ifconfig en0 | awk '/inet / {print $2}')
        - docker-compose -f ./docker/docker-compose.yaml up -d
        - . ./docker/wait-for-grid.sh
        - mvn clean test -Dtest.group=all --file server
        - docker-compose -f ./docker/docker-compose.yaml down